---
- name: Installing insights-client
  tags: always
  register: dnf_out
  ansible.builtin.dnf:
    name: insights-client
    state: present

- name: Log dnf_out
  tags: always
  when: dnf_out is defined
  ansible.builtin.debug:
    var: dnf_out
    verbosity: 2

- name: Registering {{ inventory_hostname }}
  tags: create
  register: insights_output
  ansible.builtin.command: insights-client --register

- name: Unregistering {{ inventory_hostname }}
  tags: remove
  register: insights_output
  ansible.builtin.command: insights-client --unregister

- name: Log insights_output
  tags: always
  when: insights_output is defined
  ansible.builtin.debug:
    var: insights_output
    verbosity: 2
